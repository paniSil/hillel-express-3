# ДЗ #3 Express.js

Приклад розробки сервера з використанням Express.js, демонструє використання шаблонізаторів для представлення сторніок використовуючи PUG для користувацьких маршрутів та головної сторінки та EJS для маршрутів статей.
Шаблонізатори забезпечують коректну роботу маршрутів та використовують базове налаштування для CSS стилів (Bootstrap).

## 1. Технології:

- Node.js
- Express.js
- PUG
- EJS
- Bootstrap

## 2. Основа сервера

Попередня версія сервера з описанням Middleware доступна за посиланням https://github.com/paniSil/hillel-express-2
В поточній версії аутентифікація відключена, валідація спрощена.

## 3. Використані Middleware

### 3.1. logRequests (src/middleware/logRequests.mjs)

Записує інформацію про кожен вхідний HTTP-запит (час, метод, URL) у консоль сервера. Допомагає у моніторингу та дебагінгу. Використовується глобально до всіх запитів (app.use(logRequests))

### 3.2. authHandler (src/middleware/auth.mjs)

Виконує базову аутентифікацію, перевіряючи наявність та дійсність токена авторизації. Очікує заголовок Authorization з точним значенням, яке визначено константою TOKEN у самому middleware. Якщо токен відсутній або невірний, повертає 403 Forbidden, або 401 Unauthorized, якщо токен не відповідає константі. Використовується до маршрутів, пов'язаних з користувачами (/users, /users/:userId).

### 3.3 checkAccess (src/middleware/auth.mjs)

Виконує авторизацію, перевіряючи права доступу користувача на основі його ролі. Якщо роль відсутня або не дозволена, повертає 403 Forbidden. Використовується до маршрутів, пов'язаних зі статтями (/articles, /articles/:articleId).

### 3.4 Валідатори (validateUserBody, validateParamsUserId, validateArticleBody, validateParamsArticleId) (src/middleware/articleValidation.mjs, src/middleware/userValidation.mjs,)

Виконують валідацію вхідних даних (тіла запиту або параметрів URL) за допомогою бібліотек Joi (для визначення схеми валідації) та celebrate. Якщо дані не проходять валідацію, повертає 400 Bad Request з текстовим описом помилки.

### 3.5 Обробники помилок (notFoundHandler, errorHandler) (src/middleware/errorHandler.mjs)

- notFoundHandler: Обробляє запити до неіснуючих маршрутів, повертаючи 404 Not Found.
- errorHandler: Глобальний обробник помилок, який перехоплює всі необроблені помилки в додатку. Він спеціально обробляє помилки celebrate, повертаючи 400 Bad Request з повідомленням про валідацію. Для інших помилок повертає 500 Internal Server Error.

Застосовуються глобаль в server.mjs.

## 4. Реалізовані маршрути

Маршрути реалізовані за домопогоду Express Router

### 4.1 Кореневий маршрут ('/')

Базовий маршрут для перевірки доступності сервера (дозволяє метод GET).

### 4.2 Користувачі ('/users')

Дозволено:

- отримати список користувачів (GET)
- додати нового користувача (POST)
- отримати інфо користувача за ID ('/users/:userId' - GET)
- оновити користувача за ID ('/users/:userId' - PUT)
- видалити користувача за ID ('/users/:userId' - DELETE)

### 4.3 Статті ('/articles')

- отримати всі статті (GET)
- додати нову статтю (POST)
- отримати статтю за ID ('/articles/:articleId' - GET)
- оновити статтю за ID ('/articles/:articleId' - PUT)
- видалити статтю за ID ('/articles/:articleId' - DELETE)

## 5. Використані шаблонізатори

У цьому проєкті демонструється можливість комбінованого використання різних шаблонних рушіїв в одному Express.js застосунку.

### 5.1. PUG для сторінок користувачів та індексу

PUG використовується для рендерингу сторінок, що стосуються управління користувачами:

- сторінка списку усіх користувачів (/users)
- сторінка з інформацією про кожного окремого користувача (/users/:id).

А також для рендеру головної сторінки і її інтерфейсу.

### 5.2. EJS для сторіонок статей

EJS застосовується для візуалізації сторінок, пов'язаних зі статтями:

- сторінка списку всіх статей (/articles).
- сторінка окремої статті (/articles/:id)

## 6. Налаштування репозиторію і запуск сервера:

### 6.1. Завантажуємо репозиторій та розгортаємо проект

`npm install`

або

`yarn`

_yarn повинен бути встановлений глобально, це можна зробити командой:_

`npm i -g yarn`

### 6.2. Запускаємо сервер

`npm start

# або

node src/server.mjs`

### 6.3. Перевіряємо роботу сервера

Сервер буде запущено на порту 3000. Ви побачите повідомлення у консолі: Сервер запущений за адресою http://localhost:3000.

### 6.4. Припинення роботи сервера

Необхідно повернутися до терміналу і натиснути комбінацію клавіш Ctrl + C
